<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Obor App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --p: #248b1d; --bg: var(--tg-theme-bg-color); --txt: var(--tg-theme-text-color); }
        body { font-family: sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding: 20px; }
        .step { display: none; transition: 0.3s; }
        .active { display: block; }
        button { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: none; background: var(--p); color: white; font-weight: bold; cursor: pointer; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; background: var(--tg-theme-secondary-bg-color); color: var(--txt); }
        .loc-status { font-size: 12px; color: var(--p); margin-bottom: 10px; }
    </style>
</head>
<body>
    <div id="step1" class="step active">
        <h2>üåê –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / Tilni tanlang</h2>
        <button onclick="setLang('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
        <button onclick="setLang('uz')">üá∫üáø O'zbekcha</button>
    </div>

    <div id="step2" class="step">
        <h2 id="h2_2">–ß—Ç–æ –≤–µ–∑–µ–º?</h2>
        <input type="text" id="what" placeholder="–ß—Ç–æ –ø—Ä–∏–≤–µ–∑—Ç–∏?">
        <input type="text" id="from" placeholder="–û—Ç–∫—É–¥–∞ –∑–∞–±—Ä–∞—Ç—å?">
        <input type="text" id="weight" placeholder="–ü—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å">
        <button onclick="next(3)">–î–∞–ª–µ–µ / Keyingi</button>
    </div>

    <div id="step3" class="step">
        <h2 id="h2_3">–í–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</h2>
        <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è">
        <input type="tel" id="phone" value="+998">
        <p class="loc-status" id="l_stat"></p>
        <button onclick="getLoc()" style="background: #555;">üìç –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>
        <button onclick="sendOrder()">‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        let order = { lat: 0, lon: 0 };
        tg.expand();

        function setLang(l) {
            order.lang = l;
            if(l === 'uz') {
                document.getElementById('h2_2').innerText = 'Nima olib kelish kerak?';
                document.getElementById('h2_3').innerText = 'Kontaktlar';
            }
            next(2);
        }

        function next(s) {
            document.querySelectorAll('.step').forEach(e => e.classList.remove('active'));
            document.getElementById('step'+s).classList.add('active');
        }

        function getLoc() {
            navigator.geolocation.getCurrentPosition(pos => {
                order.lat = pos.coords.latitude;
                order.lon = pos.coords.longitude;
                document.getElementById('l_stat').innerText = "‚úÖ –õ–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞ / Lokatsiya olindi";
            }, () => alert("–í–∫–ª—é—á–∏—Ç–µ GPS!"));
        }

        function sendOrder() {
            order.what = document.getElementById('what').value;
            order.from = document.getElementById('from').value;
            order.weight = document.getElementById('weight').value;
            order.name = document.getElementById('name').value;
            order.phone = document.getElementById('phone').value;

            if(!order.name || !order.phone) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å—ë!");
            tg.sendData(JSON.stringify(order));
        }
    </script>
</body>
</html>